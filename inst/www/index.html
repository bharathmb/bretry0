<!DOCTYPE html>
<html>
  <head>
    <title>Simple Plot</title>
    
    <!-- Include order: first jquery, then opencpu.js, and then your code -->
    <script src="opencpu/jquery-1.10.2.min.js"></script>
    <script src="opencpu/opencpu-0.4.js"></script>

    <script>
    //init this script when the page has loaded
    $(document).ready(function(){

      $("#submitbutton").on("click", function(){
        
        //disable the button to prevent multiple clicks
        $("#submitbutton").attr("disabled", "disabled");
		
		uploadcsv(filename); 
        
        //read the value for 'myname'
		var nfield =1000;
		var distfield="normal";
        
        //create the plot area on the plotdiv element
        var req = $("#plotdiv").rplot("randomplot", {
          n : nfield,
          dist : distfield
        })

        //if R returns an error, alert the error message
        req.fail(function(){
          alert("Server error: " + req.responseText);
        });
        
        //after request complete, re-enable the button 
        req.always(function(){
          $("#submitbutton").removeAttr("disabled")
        });
      });
 
	
	function uploadcsv(filename){
	 alert("inside uploadcsv....");
    //disable the button during upload
    $("#submitbutton").attr("disabled", "disabled");  
    //perform the request
    var req = ocpu.call("read_csv", {
      file : filename
    }, function(session){
      //on success call printsummary()
      printsummary(session);
    });
    
    //if R returns an error, alert the error message
    req.fail(function(){
      alert("Server error: " + req.responseText);
    });
    
    //after request complete, re-enable the button 
    req.always(function(){
      $("#submitbutton").removeAttr("disabled")
    });        
  }    
  
  
  function printsummary(mydata){
	  alert("inside printsummary....");
    //perform the request
    var req = ocpu.call("printsummary", {
      df_full : mydata
    }, function(session){
      session.getConsole(function(output){
        $("#output code").text(output);	
	
		//FUNCTION CALLS TO SIGNIFICANT VARIABLE LIST & GRAPHS PLOTS
	  //plot_graph();
      	  
		  //add_var_list();
		  
    }).fail(function(){
      alert("Server error: " + req.responseText);
    });        
  });
  }
  
  
		//Adding code for var_list call
	
		function add_var_list()
			{
				alert("inside Add Options");
				var vars;
				var req = ocpu.call("imp_var_list", {	"target.var.name" : dvname	}, 
			function(session){
				session.getObject(function(data){
				//$("#output code").text(data);	
				alert("imp_var_list ends: trying to append" );
				
				for (var i=0; i < data.length;++i)
				{
					alert("inside_for " + i);
					var x = document.getElementById("DropList");
					var option = document.createElement("option");
					option.text = data[i];
					x.add(option);
					
					alert("option " + i + " added")
					
					//addOption(document.DropList, data[i], data[i]);
					
				}

				}).fail(function(){
					alert("R returned an error in var_list: " + req.responseText);
					});
				});
				
				}
				
	
		//VAR LIST CALL ENDS
		
		//Adding COde for Significant variables graph
				function plot_graph()
			{
				alert("inside Plot graph");
				
				//var req = $("#plotdiv").rplot("top_var_graph", {"target.var.name" : dvname});
				
				var req = $("#plotdiv").rplot("randomplot", {	n : 100, dist : "normal"})
				
				//if R returns an error, alert the error message
				req.fail(function(){
				alert("Server error: " + req.responseText);
				});
				
				//after request complete, re-enable the button 
				req.always(function(){
				$("#submitbutton").removeAttr("disabled")
				});
				alert("plotted");
			
			}
			
			}
	);
	
    </script>
    
    <style>
      #plotdiv {
        position: relative;
        width: 600px;
        height: 400px;
        border: solid gray 1px;
      }
    </style>
    
  </head>
    
  <body>
    <h1>Basic plotting</h1>
    
    <b>n (count) </b> <input type="number" id="nfield" value="1000">
    
    <b>distribution type</b> <select id="distfield">
      <option>normal</option>
      <option>uniform</option>
    </select> 
    
    <br />
    <button id="submitbutton" type="button">Submit to server!</button>
    
    <div id="plotdiv"></div>      

    <br />

    <p>
     This page shows the <tt>opencpu.js</tt> plot widget. We use <tt>jQuery.rplot</tt> plugin from the <tt>opencpu.js</tt> library to call the R function called <a href="../R/randomplot">randomplot</a>.</li> included in this R package. 
    </p>
    
  </body>
</html>
